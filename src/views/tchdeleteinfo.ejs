<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="../css/cssdir/out.css" rel="stylesheet" />
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <title>Banco de Dados - Guilda</title>
  </head>
  <body class="min-h-screen flex items-center justify-center bg-slate-900">
    <div class="pages_cont p-8 rounded-lg shadow-md w-full max-w-6xl">
      <div class="flex items-end gap-5 px-4 sm:px-0">
        <div class="flex-shrink-0">
          <% if (info.icon && info.icon.indexOf('null') === -1) { %>
          <img
            src="<%= info.icon %>"
            alt="Ícone da guilda"
            class="w-24 h-24 rounded-lg object-cover"
          />
          <% } else { %>
          <img
            src="/res/serverIcon/nonserverimg.jpg"
            alt="Ícone padrão"
            class="w-24 h-24 rounded-lg object-cover"
          />
          <% } %>
        </div>
        <div class="flex-1">
          <h3 class="text-xl font-semibold text-white">
            Deletar Lives do Twitch
          </h3>
          <p class="mt-1 max-w-2xl text-sm text-gray-400">
            Guilda: <%= info.name %>
          </p>
        </div>
        <div class="items-end">
          <form
            id="deleteForm"
            style="display: none"
            method="post"
            onsubmit="event.preventDefault(); confirmarExclusao();"
          >
            <input type="hidden" name="youtube" id="youtubeInput" />
            <input type="hidden" name="func" value="deltwitchch" />
            <input type="hidden" name="channelId" id="channelIdInput" />

            <button type="submit" class=" bg-red-800 hover:bg-red-300 text-white text-sm font-medium py-2 px-4 rounded-lg shadow-md transition cursor-pointer">Confirmar Exclusão</button>
          </form>
        </div>
      </div>

      <!-- Tabela -->
      <div class="flex max-w-6xl mt-8">
        <table class="w-full table-fixed divide-y divide-white-700">
          <thead>
            <tr>
              <th
                class="w-[40%] py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-white sm:pl-0"
              >
                Twitch
              </th>
              <th
                class="w-[40%] px-3 py-3.5 text-left text-sm font-semibold text-white"
              >
                Channel
              </th>
              <th
                class="w-[20%] px-3 py-3.5 text-center text-sm font-semibold text-white"
              >
                Deletar
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-white-700">
            <% info2.forEach(item => { %>
            <tr>
              <td
                class="truncate py-4 pl-4 pr-3 text-sm font-medium text-gray-300 sm:pl-0"
              >
                <%= item.twitch %>
              </td>
              <td class="truncate px-3 py-4 text-sm text-gray-400">
                <%= item.channel %>
              </td>
              <td class="px-3 py-4 text-center">
                <button
                  class="bg-red-800 hover:bg-red-300 text-white text-sm font-medium py-2 px-4 rounded-lg shadow-md transition cursor-pointer"
                  onclick="preencherForm('<%= item.twitch %>', '<%= item.guildID %>')"
                >
                  Excluir
                </button>
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>

    <script>
      function preencherForm(youtube, channelId) {
        document.getElementById("youtubeInput").value = youtube;
        document.getElementById("channelIdInput").value = channelId;

        // Exibe o formulário
        document.getElementById("deleteForm").style.display = "block";
      }

      function confirmarExclusao() {
        var dadosFormulario = $("#deleteForm").serializeArray();
        parent.dtbaseDelete(dadosFormulario);

        // Oculta o formulário após a submissão
        document.getElementById("deleteForm").style.display = "none";
      }
    </script>
  </body>
</html>
