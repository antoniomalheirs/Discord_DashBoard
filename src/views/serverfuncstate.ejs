<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="../css/cssdir/out.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <title>Gerenciador de Funções</title>
</head>

<body class="bg-transparent min-h-full flex items-start justify-center pt-10">
  <div
    class="bg-gray-800/80 backdrop-blur-md border border-gray-700 p-8 rounded-2xl shadow-2xl w-full max-w-full animate-fade-in-up">

    <!-- Header -->
    <div class="flex items-center gap-6 mb-8 border-b border-gray-700/50 pb-6">
      <div class="relative group">
        <div
          class="absolute -inset-1 bg-blue-600 rounded-lg blur opacity-25 group-hover:opacity-100 transition duration-1000 group-hover:duration-200">
        </div>
        <% if (info.icon && info.icon.indexOf('null')===-1) { %>
          <img src="<%= info.icon %>" alt="Ícone da guilda"
            class="relative w-20 h-20 rounded-lg object-cover shadow-lg ring-2 ring-gray-700" />
          <% } else { %>
            <img src="/res/serverIcon/nonserverimg.jpg" alt="Ícone padrão"
              class="relative w-20 h-20 rounded-lg object-cover shadow-lg ring-2 ring-gray-700" />
            <% } %>
      </div>
      <div class="flex-1">
        <h3 class="text-2xl font-bold text-white mb-2 flex items-center gap-3">
          <i class="fa-solid fa-toggle-on text-blue-500"></i>
          Funções Ativas
        </h3>
        <p class="text-gray-400 text-sm max-w-2xl">Visão geral dos módulos de notificação habilitados para <strong>
            <%= info.name %>
          </strong>.</p>
      </div>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">

      <!-- Poker Manager -->
      <a href="/bot/pagina/funcpoker/<%= info.id %>"
        class="group bg-gray-800/60 backdrop-blur-sm border border-gray-700/50 rounded-2xl p-6 hover:bg-gray-800 hover:border-red-500/50 hover:shadow-2xl hover:shadow-red-900/10 transition-all duration-300 relative overflow-hidden">
        <div class="absolute top-0 right-0 p-4 opacity-50">
          <% if (info4.poker && info4.poker.state) { %>
            <div class="h-3 w-3 rounded-full bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.5)] animate-pulse"></div>
            <% } else { %>
              <div class="h-3 w-3 rounded-full bg-gray-600"></div>
              <% } %>
        </div>

        <div
          class="flex items-center justify-center w-14 h-14 bg-red-900/20 rounded-xl mb-4 group-hover:scale-110 transition-transform duration-300">
          <i class="fa-solid fa-heart text-2xl text-red-500"></i>
        </div>

        <h3 class="text-xl font-bold text-gray-100 mb-2 group-hover:text-red-400 transition-colors">Poker</h3>
        <p class="text-gray-400 text-sm leading-relaxed">
          Configure a mesa de Poker Texas Hold'em e defina o canal permitido.
        </p>
      </a>

      <!-- Youtube Status Card -->
      <div class="bg-gray-700/40 border border-gray-600/50 rounded-xl p-6 relative overflow-hidden group">
        <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
          <i class="fa-brands fa-youtube text-6xl text-red-500"></i>
        </div>
        <div class="flex items-center justify-between mb-4">
          <h4 class="text-white font-bold text-lg flex items-center gap-2">
            <i class="fa-brands fa-youtube text-red-500"></i> YouTube
          </h4>
          <% if (info4.youtubenotify) { %>
            <span
              class="px-3 py-1 text-xs font-bold rounded-full bg-green-500/20 text-green-400 border border-green-500/30">ATIVO</span>
            <% } else { %>
              <span
                class="px-3 py-1 text-xs font-bold rounded-full bg-red-500/20 text-red-400 border border-red-500/30">DESATIVADO</span>
              <% } %>
        </div>
        <div class="space-y-2">
          <p class="text-gray-400 text-sm">Canal de Notificações:</p>
          <div class="bg-gray-800/50 p-2 rounded border border-gray-700 font-mono text-gray-300 text-sm truncate">
            <% if (info4.channelytb) { %>
              <i class="fa-solid fa-hashtag text-gray-500 mr-1"></i>
              <%= info4.channelytb %>
                <% } else { %>
                  <span class="text-gray-600">Nenhum canal configurado</span>
                  <% } %>
          </div>
        </div>
      </div>

      <!-- Twitch Status Card -->
      <div class="bg-gray-700/40 border border-gray-600/50 rounded-xl p-6 relative overflow-hidden group">
        <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
          <i class="fa-brands fa-twitch text-6xl text-purple-500"></i>
        </div>
        <div class="flex items-center justify-between mb-4">
          <h4 class="text-white font-bold text-lg flex items-center gap-2">
            <i class="fa-brands fa-twitch text-purple-500"></i> Twitch
          </h4>
          <% if (info4.twitchnotify) { %>
            <span
              class="px-3 py-1 text-xs font-bold rounded-full bg-green-500/20 text-green-400 border border-green-500/30">ATIVO</span>
            <% } else { %>
              <span
                class="px-3 py-1 text-xs font-bold rounded-full bg-red-500/20 text-red-400 border border-red-500/30">DESATIVADO</span>
              <% } %>
        </div>
        <div class="space-y-2">
          <p class="text-gray-400 text-sm">Canal de Notificações:</p>
          <div class="bg-gray-800/50 p-2 rounded border border-gray-700 font-mono text-gray-300 text-sm truncate">
            <% if (info4.channeltch) { %>
              <i class="fa-solid fa-hashtag text-gray-500 mr-1"></i>
              <%= info4.channeltch %>
                <% } else { %>
                  <span class="text-gray-600">Nenhum canal configurado</span>
                  <% } %>
          </div>
        </div>
      </div>

      <% const logModules=[ { key: 'message_delete' , label: 'Msg Deletada' , icon: 'fa-trash' , color: 'text-red-400'
        }, { key: 'message_update' , label: 'Msg Editada' , icon: 'fa-pen-to-square' , color: 'text-blue-400' }, {
        key: 'voice_update' , label: 'Voz (Entrada/Saída)' , icon: 'fa-microphone' , color: 'text-green-400' }, {
        key: 'member_join' , label: 'Entrada de Membro' , icon: 'fa-user-plus' , color: 'text-green-500' }, {
        key: 'member_leave' , label: 'Saída de Membro' , icon: 'fa-user-minus' , color: 'text-red-500' }, {
        key: 'member_ban' , label: 'Membro Banido' , icon: 'fa-gavel' , color: 'text-red-600' }, { key: 'economy_log' ,
        label: 'Log de Economia' , icon: 'fa-coins' , color: 'text-yellow-400' }, { key: 'channel_update' ,
        label: 'Canais' , icon: 'fa-server' , color: 'text-indigo-400' }, { key: 'role_update' , label: 'Cargos' ,
        icon: 'fa-id-badge' , color: 'text-pink-400' }, { key: 'server_update' , label: 'Updates do Servidor' ,
        icon: 'fa-gear' , color: 'text-gray-400' }, { key: 'invite_update' , label: 'Convites' , icon: 'fa-envelope' ,
        color: 'text-cyan-400' }, ]; %>

        <% logModules.forEach(mod=> { %>
          <% const logData=info4.logging && info4.logging[mod.key] ? info4.logging[mod.key] : { state: false,
            channel: '' }; %>
            <div
              class="bg-gray-700/40 border border-gray-600/50 rounded-xl p-6 relative overflow-hidden group hover:border-gray-500 transition-colors">
              <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <i class="fa-solid <%= mod.icon %> text-6xl <%= mod.color %>"></i>
              </div>
              <div class="flex items-center justify-between mb-4">
                <h4 class="text-white font-bold text-lg flex items-center gap-2">
                  <i class="fa-solid <%= mod.icon %> <%= mod.color %>"></i>
                  <%= mod.label %>
                </h4>
                <% if (logData.state) { %>
                  <span
                    class="px-3 py-1 text-xs font-bold rounded-full bg-green-500/20 text-green-400 border border-green-500/30">ATIVO</span>
                  <% } else { %>
                    <span
                      class="px-3 py-1 text-xs font-bold rounded-full bg-gray-600/30 text-gray-400 border border-gray-600/50">DESATIVADO</span>
                    <% } %>
              </div>
              <div class="space-y-4">
                <div>
                  <p class="text-gray-400 text-sm mb-1">Canal de Log:</p>
                  <div
                    class="bg-gray-800/50 p-2 rounded border border-gray-700 font-mono text-gray-300 text-sm truncate flex items-center h-9">
                    <% if (logData.channel) { %>
                      <i class="fa-solid fa-hashtag text-gray-500 mr-2"></i>
                      <span>
                        <%= logData.channel %>
                      </span>
                      <% } else { %>
                        <span class="text-gray-600 italic"> <i class="fa-solid fa-ban mr-1"></i> Não configurado</span>
                        <% } %>
                  </div>
                </div>

                <button
                  onclick="openLogModal('<%= mod.key %>', '<%= mod.label %>', '<%= logData.channel %>', <%= logData.state %>)"
                  class="w-full flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600 text-gray-200 text-sm font-semibold py-2 px-4 rounded-lg transition-colors border border-gray-600 hover:border-gray-500">
                  <i class="fa-solid fa-gear"></i> Configurar
                </button>
              </div>
            </div>
            <% }); %>
    </div>

    <!-- Config Log Modal -->
    <div id="logModal" class="hidden fixed inset-0 z-[9999] overflow-y-auto" aria-labelledby="modal-title" role="dialog"
      aria-modal="true">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-gray-900/80 transition-opacity backdrop-blur-sm" onclick="closeLogModal()"></div>

        <div class="relative w-full max-w-lg bg-gray-800 rounded-2xl shadow-2xl border border-gray-700 p-6 z-50">

          <div class="mb-6">
            <h3 class="text-xl leading-6 font-bold text-white mb-2 flex items-center gap-2">
              <i class="fa-solid fa-gear text-blue-500"></i>
              Configurar: <span id="modalLogTitle" class="text-blue-400"></span>
            </h3>
            <p class="text-gray-400 text-sm">Ative ou desative este módulo e defina o canal de destino.</p>
          </div>

          <div class="space-y-4">
            <!-- Enable Toggle -->
            <div class="flex items-center bg-gray-700/50 p-3 rounded-lg border border-gray-600 cursor-pointer">
              <input type="checkbox" id="logState"
                class="h-5 w-5 rounded bg-gray-700 border-gray-500 text-blue-600 focus:ring-blue-500 focus:ring-offset-gray-800 transition py-4" />
              <label for="logState" class="ml-3 block text-sm font-medium text-gray-200 cursor-pointer select-none">
                Ativar este módulo de log
              </label>
            </div>

            <!-- Channel Input -->
            <div>
              <label for="logChannelId" class="block text-sm font-medium text-gray-400 mb-1">ID do Canal de Texto
                (Discord):</label>
              <input type="text" id="logChannelId" placeholder="Ex: 123456789012345678"
                class="w-full bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 placeholder-gray-500" />
              <p class="mt-1 text-xs text-gray-500">Canais de log devem ser canais de texto válidos.</p>
            </div>

            <input type="hidden" id="logKey" />
          </div>

          <div class="mt-6 flex flex-row-reverse gap-3">
            <button type="button" onclick="saveLogConfig()"
              class="w-full inline-flex justify-center rounded-lg border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:w-auto sm:text-sm transition-colors">
              Salvar Alterações
            </button>
            <button type="button" onclick="closeLogModal()"
              class="w-full inline-flex justify-center rounded-lg border border-gray-600 shadow-sm px-4 py-2 bg-gray-800 text-base font-medium text-gray-300 hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 sm:w-auto sm:text-sm transition-colors">
              Cancelar
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      function openLogModal(key, title, channel, state) {
        document.getElementById('modalLogTitle').textContent = title;
        document.getElementById('logKey').value = key;
        document.getElementById('logChannelId').value = channel || '';
        document.getElementById('logState').checked = state;

        document.getElementById('logModal').classList.remove('hidden');
      }

      function closeLogModal() {
        document.getElementById('logModal').classList.add('hidden');
      }

      function saveLogConfig() {
        const key = document.getElementById('logKey').value;
        const channelId = document.getElementById('logChannelId').value;
        const state = document.getElementById('logState').checked;
        const guildId = '<%= info4.guildID %>'; // Assuming info4.guildID is available

        if (state && !channelId) {
          alert("Para ativar, você deve fornecer um ID de canal válido.");
          return;
        }

        let action = '';
        // If active, we use actlog_KEY. If inactive, deactlog_KEY.
        // Note: actlog requires channelId. deactlog might not, but we pass 0 or dummy.

        if (state) {
          action = 'actlog_' + key;
        } else {
          action = 'deactlog_' + key;
        }

        const dados = [
          { name: "guildId", value: guildId },
          { name: "func", value: action },
          { name: "channelId", value: channelId || "0" }
        ];

        if (parent && typeof parent.funcsReload === 'function') {
          parent.funcsReload(dados);
          closeLogModal();
        } else {
          console.error("Parent funcsReload not found");
        }
      }
    </script>
  </div>

  <!-- Raw Data (Optional / Debug) -->
  <div class="mt-8 pt-6 border-t border-gray-700/50">
    <p class="text-xs text-gray-500 font-mono mb-2 uppercase tracking-wide">ID de Referência do Servidor</p>
    <div class="bg-gray-900/50 p-3 rounded-lg border border-gray-800 font-mono text-gray-400 text-sm">
      <%= info4.guildID %>
    </div>
  </div>

  </div>
</body>

</html>